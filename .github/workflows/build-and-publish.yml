name: Build and Publish

on: 
  push:
    branches:
    - master
  pull_request:
    branches:
    - master

env:
  DOCKER_REGISTRY: ghcr.io
  IMAGE_NAME: baboon-co/iron-forge-auth
  REGISTRY_IMAGE_NAME: $DOCKER_REGISTRY/$IMAGE_NAME:latest

jobs:
  build-and-publish:
    runs-on: ubuntu-latest

    steps:
      - name: Login registry
        run: docker login ${{ vars.DOCKER_REGISTRY }} -u ${{ secrets.DOCKER_REGISTRY_USERNAME }} -p ${{ secrets.DOCKER_REGISTRY_PASSWORD }}
    
      - name: Checkout
        uses: actions/checkout@v4.1.2
    
      - name: Build image
        run: docker build -t $REGISTRY_IMAGE_NAME .

      - name: Push image to registry
        run: docker push $REGISTRY_IMAGE_NAME
